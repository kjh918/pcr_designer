<!-- app/templates/results_single.html -->

<hr>
<h2>Single Region Result</h2>

<p>
  Region:
  {{ single_result.region.chrom }}:
  {{ single_result.region.start }} - {{ single_result.region.end }}
  (총 {{ single_result.total_count }}개, QC 통과 {{ single_result.filtered_count }}개)
</p>

{% if single_filtered_amplicons %}
  <h3>QC 통과 Amplicons (Top 10)</h3>

  <table border="1" cellpadding="4" cellspacing="0">
    <thead>
      <tr>
        <th>#</th>
        <th>Amplicon Length</th>
        <th>Forward Seq</th>
        <th>Reverse Seq</th>
        <th>Forward Tm</th>
        <th>Reverse Tm</th>
        <th>Heterodimer ΔG</th>
        <th>Heterodimer Tm</th>
      </tr>
    </thead>
    <tbody>
      {% for row in single_filtered_amplicons[:10] %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ row.amplicon_length }}</td>
          <td>{{ row.forward_sequence }}</td>
          <td>{{ row.reverse_sequence }}</td>
          <td>{{ "%.2f"|format(row.forward_tm) if row.forward_tm is not none else "" }}</td>
          <td>{{ "%.2f"|format(row.reverse_tm) if row.reverse_tm is not none else "" }}</td>
          <td>{{ "%.2f"|format(row.heterodimer_dg) if row.heterodimer_dg is not none else "" }}</td>
          <td>{{ "%.2f"|format(row.heterodimer_tm) if row.heterodimer_tm is not none else "" }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- QC 통과 전체 다운로드 -->
  <!-- <form method="post" action="/design/export" style="margin-top: 1rem;">
    <input type="hidden" name="kind" value="single_filtered">
    <textarea name="data_json" style="display:none;">
      {{ single_filtered_amplicons | tojson }}
    </textarea>
    <button type="submit">Export Filtered (Excel)</button>
  </form> -->
{% endif %}

{% if single_total_amplicons %}
  <h3>전체 Amplicons 다운로드</h3>
  <form method="post" action="/design/export">
    <input type="hidden" name="kind" value="single_total">
    <textarea name="data_json" style="display:none;">
      {{ single_total_amplicons | tojson }}
    </textarea>
    <button type="submit">Export All (Excel)</button>
  </form>
{% endif %}
